const $=s=>document.querySelector(s);
document.getElementById?.('year') && (document.getElementById('year').textContent=new Date().getFullYear());
const themeBtn=document.getElementById('theme-toggle'); if(themeBtn){themeBtn.addEventListener('click',()=>{const h=document.documentElement;const l=h.getAttribute('data-theme')==='light';h.setAttribute('data-theme',l?'dark':'light');themeBtn.textContent=l?'Light':'Dark';});}
const dict={en:{cta_quote:'Get a Quote',cta_call:'Email Us',rights:'All rights reserved'},ru:{cta_quote:'Рассчитать цену',cta_call:'Написать нам',rights:'Все права защищены'}};let lang='en';
const langBtn=document.getElementById('lang-toggle');function i18n(){const d=dict[lang];document.querySelectorAll('[data-i18n]').forEach(el=>{const k=el.dataset.i18n;d[k]&&(el.textContent=d[k])});}
if(langBtn){langBtn.addEventListener('click',()=>{lang=lang==='en'?'ru':'en';langBtn.textContent=lang==='en'?'RU':'EN';i18n();});i18n();}
(function(){const p=location.pathname.split('/').pop()||'index.html';document.querySelectorAll('.nav a.link').forEach(a=>{const h=a.getAttribute('href');if(h&&h.endsWith(p))a.classList.add('active')})})();
const form=document.getElementById('quote-form');if(form){form.addEventListener('submit',async e=>{e.preventDefault();const status=document.getElementById('form-status');status&&(status.textContent=lang==='ru'?'Отправка…':'Sending…');const data=new FormData(form);const fs=form.querySelector('input[name="_formspree"]');const ep=form.querySelector('input[name="_endpoint"]');if(!fs&&!ep){alert('Form data (demo):\n\n'+JSON.stringify(Object.fromEntries(data.entries()),null,2));status&&(status.textContent=lang==='ru'?'Готово (демо). Подключите Formspree или Apps Script.':'Done (demo). Connect Formspree or Apps Script.');return;}const url=fs?fs.value:ep.value;try{const res=await fetch(url,{method:'POST',body:data,headers:{'Accept':'application/json'}});if(!res.ok)throw new Error(res.statusText);form.reset();status&&(status.textContent=lang==='ru'?'Спасибо! Мы свяжемся с вами.':'Thanks! We will contact you soon.');}catch(err){status&&(status.textContent=lang==='ru'?'Ошибка отправки. Проверьте настройки формы.':'Submission failed. Check form settings.');}});}